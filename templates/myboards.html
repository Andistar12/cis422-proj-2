{% extends "parent_layout.html" %}
{% set active_page = "myboards" %}
{% block content %}

<!-- This is the user board page where we display all boards user is subscribed to. Allow to unsubscribe from board. -->

<section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-4 py-12">
    <div class="text-center pb-12">
        <h1 class="font-bold text-3xl md:text-4xl lg:text-5xl font-heading">
            My Boards
        </h1>
    </div>
    <div class="grid place-items-center grid-cols-1 sm:grid-cols-2  md:grid-cols-2 lg:grid-cols-3 gap-4 xl:grid-cols-4 justify-center" id="myboard_section"></div>
</section>

<!-- Define the template for an arbitrary board -->
<template id="myboard_template">
    <div class="w-full max-w-md py-4 px-8 bg-nav_grey shadow-lg rounded-lg my-20 flex flex-col justify-center">
        <div>
            <h3 class="text-jade text-3xl font-semibold">Temp Board Name</h3>
            <p class="mt-2">Lorem ipsum dolor sit amet consectetur adipisicing elit. Quae dolores deserunt ea doloremque natus error, rerum quas odio quaerat nam ex commodi hic, suscipit in a veritatis pariatur minus consequuntur!</p>
        </div>
        <div class="flow-root mt-4">
            <button class="float-left">Unsubscribe</button>
            <a href="#" class="float-right text-xl font-medium text-chardonnay">View -></a>
        </div>
        </div>
</template>

<!-- Define the template for having no boards -->
<template id="myboard_noboards">
    <div class="w-full max-w-md bg-nav_grey rounded-lg justify-center">
        <p>
            You are not subscribed to any boards! <a href="findboard.html">Find a Board</a> to subscribe to!
        </p>
    </div>
</template>

<!-- Javascript to load the boards-->
<script>
    $(document).ready(function () {
        if ('content' in document.createElement('template')) {

            // Find parent section and template child to clone
            let sec = document.querySelector("#myboard_section");
            let template = document.querySelector("#myboard_template")

            // Define success function
            let success = function(data) {
                if (data.length <= 0) {
                    // No boards
                    sec.appendChild(document.querySelector("#myboard_noboards").content.cloneNode(true));
                } else {
                    data.forEach(function(board) {
                        let board_id = board["board_id"];

                        // Setup board
                        let clone = template.content.cloneNode(true);
                        let title = clone.querySelector("h3");
                        title.innerHTML = board["board_name"];
                        let desc = clone.querySelector("p");
                        desc.innerHTML = board["board_description"];
                        let link = clone.querySelector("a");
                        link.href = "/viewboard.html?board=" + board_id;
                        let btn = clone.querySelector("button");
                        btn.addEventListener("click", function() {
                            btn.disabled = true;
                            btn.style.pointerEvents = "none";
                            let btn_success = function(data) {
                                btn.innerHTML = "Unsubscribed!";
                            };
                            let btn_error = function() {
                                display_error("An error occurred subscribing. Reload the page?");
                                btn.innerHTML = "Error";
                            };
                            unsubscribe_board(board_id, btn_success, btn_error);
                        });

                        // Add board to layout
                        sec.appendChild(clone);
                    });
                }
            };

            // Define error function
            let error = function() {
                display_error("An error occurred fetching boards. Reload the page?");
            };

            // Do board fetch
            fetch_user_boards(success, error);
        }
    });
</script>

{% endblock %}
